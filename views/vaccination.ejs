<!DOCTYPE html>
<html>
    <head>
        <title>
            Vaccination
        </title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
        <style>
            .available{
                font-size: 20px;
                font-weight:bold;
                color:rgb(67, 214, 67)
            }
            .notAvailable{
                font-size: 17px;
                font-weight:bold;
                color:rgb(218, 52, 52);
            }
            .age18{
                color:rgb(247, 41, 154);
                font-weight: bold;
                font-size:20px;
            }
            .age45{
                color:rgb(49, 49, 223);
                font-weight:bold;
                font-size: 20px;
            }
            .heading{
                font-size: 30px;
                font-weight:bold;
                color:rgb(158, 212, 48)
            }
            .covaxin{
                font-weight: bold;
                color:rgb(165, 126, 42)
            }
        </style>
    </head>
    <body onload="loadDistrict()">
        <%-include('./partials/navbar')%>
        <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    
                    <img style="height:500px" src="https://www.bioworld.com/ext/resources/Stock-images/Therapeutic-topics/Infectious/COVID-19-vaccine.png?1590079334" class="d-block w-100 mt-0" alt="...">
                    
                </div>
                <div class="carousel-item">
                    <img style="height:500px" src="https://cdn.cancercenter.com/-/media/ctca/images/others/blogs/2018/01-january/07-blog-vaccines-l.jpg" class="d-block w-100" alt="...">
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
        <br>
        <h1 class=text-center>
            Get vaccinated Soon
        </h1>
        <br>
        <div class="d-flex justify-content-around">
        <button class="btn btn-primary" id="pinNumber" onclick='pinCode()'>Search by Pin</button>
        <button class="btn btn-primary" id="districtNumber" onclick='districtNumber()'>Search by District</button>
        </div>
        <br>
        <div id="state" hidden>
            <div class="d-flex justify-content-center">
            <select id="selectedState" onchange="selectDistrict()">
                <option value="">Select State</option>
                <%for(let i=0;i<=36;i++){%>
                <option class="allStates" value=""></option>
                <%}%>
            </select>
            <div >
            <select id="selectedDistricts">
                    <option name="option2" value="">Select District</option>
            </select>
            </div>
            </div>
            <br>
            <div class="d-flex justify-content-center">
                <button type="submit" onclick="districtsCenters()" class="btn btn-success">Submit</button>
                </div>
            </div>

        <div id="pincode" hidden>
            <div class="d-flex justify-content-center">
            <input type="text" id="pin" placeholder="Enter the pin">
            <input type="date" id="date" placeholder="Date">
        </div>
        <br>
        <div class="d-flex justify-content-center">
        <button type="submit" onclick="pinCenters()" class="btn btn-success">Submit</button>
        </div>
        </div>
        <br>
        <br>
        <br>
        <div class="container d-flex justify-content-center">
        <div id="searchResults" class="table-responsive">

        </div>
        </div>
        <div class="text-center" id="noResultFound" hidden>
            <h1>No Results Found</h1>
        </div>
        <%-include('./partials/footer')%>;
        <script>
            pin=document.getElementById('pinNumber');
            district=document.getElementById('districtNumber');
            function pinCode()
            {
                
                pincode=document.getElementById('pincode');
                state=document.getElementById("state");
                pincode.hidden=false;
                state.hidden=true;
            }
            function districtNumber()
            {
                pincode=document.getElementById('pincode');
                state=document.getElementById("state");
                state.hidden=false;
                pincode.hidden=true;
                
            }
            async function loadDistrict()
            {
                const response=await fetch("https://cdn-api.co-vin.in/api/v2/admin/location/states");
                const resp=await response.json();
                let allStates=document.getElementsByClassName('allStates');
                console.log(resp.states);
                for(let i=0;i<resp.states.length;i++)
                {
                    allStates[i].innerHTML=resp.states[i].state_name;
                    allStates[i].value=resp.states[i].state_id;
                }

            }
            async function selectDistrict()
            {
                const selectedState=document.getElementById('selectedState').value;
                const selectedDistricts=document.getElementById('selectedDistricts');
                const deleteOptions=document.getElementById('deleteOptions');
                //selectedDistricts.parentNode.removeChild(option);
                //const removeDistricts=selectedDistricts.getElementsByTagName('option').removeChild(option);
                //const newSelectedDistricts=document.createElement('select');
                //newSelectedDistricts.setId('selectDistrict');
               const response=await fetch(`https://cdn-api.co-vin.in/api/v2/admin/location/districts/${selectedState}`);
                const resp=await response.json();
                console.log(resp.districts)
                //selectedDistricts.remove();
                for(let i=0;i<resp.districts.length;i++)
                {
                    let opt=document.createElement('option');
                    opt.innerHTML=resp.districts[i].district_name;
                    opt.value=resp.districts[i].district_id;
                    selectedDistricts.appendChild(opt);
                }
                
            }
            async function pinCenters()
            {
                const searchResults=document.getElementById("searchResults");
                const date=document.getElementById('date').value;
                const pin=document.getElementById('pin').value;
                let dateArray=date.split("-");
                let newDate=dateArray[2]+"-"+dateArray[1]+"-"+dateArray[0]
                let i=0;
                console.log(pin);
                console.log(newDate);
                const response=await fetch(`https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/findByPin?pincode=${pin}&date=${newDate}`);
                const resp=await response.json();
                console.log(resp);
                if(resp.sessions.length>0)
                {
                    searchResults.hidden=false;
                    document.getElementById('noResultFound').hidden=true;
                    let newTable=document.createElement('table');
                    newTable.classList.add("table");
                    newTable.classList.add("table-bordered");
                    newTable.classList.add("table-striped");
                    let thead=document.createElement('thead');
                    let thead2=document.createElement('thead');
                    thead2.innerHTML=resp.sessions[0].date
                    newTable.appendChild(thead2);
                    let th= document.createElement('th');
                    th.innerHTML="Center Name";
                    thead.appendChild(th);
                    let th2= document.createElement('th');
                    th2.innerHTML="Address";
                    thead.appendChild(th2);
                    let th3= document.createElement('th');
                    th3.innerHTML="Age Limit";
                    thead.appendChild(th3);
                    let th4= document.createElement('th');
                    th4.innerHTML="Fee Type";
                    thead.appendChild(th4);
                    let th5= document.createElement('th');
                    th5.innerHTML="Dose1";
                    thead.appendChild(th5);
                    let th6= document.createElement('th');
                    th6.innerHTML="Dose2";
                    thead.appendChild(th6);
                    let th7= document.createElement('th');
                    th7.innerHTML="Vaccine";
                    thead.appendChild(th7);
                    thead.classList.add("heading");
                    newTable.appendChild(thead);
                    let tbody;
                    tbody=document.createElement('tbody');
                    for(let i of resp.sessions){
                        let tr=document.createElement('tr');
                        for(let j=0;j<1;j++)
                        {
                            let td=document.createElement('th');
                            td.innerHTML=i.name;
                            tr.appendChild(td);
                            let td2=document.createElement('td');
                            td2.innerHTML=i.address;
                            tr.appendChild(td2);
                            let td3=document.createElement('td');
                            td3.innerHTML=i.min_age_limit+"+";
                            if(i.min_age_limit==18)
                            td3.classList.add("age18");
                            else
                            td3.classList.add("age45");
                            tr.appendChild(td3);
                            let td4=document.createElement('td');
                            td4.innerHTML=i.fee_type;
                            if(i.fee_type=="Paid")
                            td4.classList.add("notAvailable");
                            else
                            td4.classList.add("available")
                            tr.appendChild(td4);
                            let td5=document.createElement('td');
                            td5.innerHTML=i.available_capacity_dose1+"+";
                            if(i.available_capacity_dose1==0)
                            {
                                td5.innerHTML="Booked";
                            td5.classList.add("notAvailable");
                            }
                            else
                            td5.classList.add("available")
                            tr.appendChild(td5);
                            let td6=document.createElement('td');
                            td6.innerHTML=i.available_capacity_dose2+"+";
                            if(i.available_capacity_dose2==0)
                            {
                                td6.innerHTML="Booked";
                                td6.classList.add("notAvailable")
                            }
                            else
                            td6.classList.add("available")
                            tr.appendChild(td6);
                            let td7=document.createElement('td');
                            td7.innerHTML=i.vaccine;
                            if(i.vaccine =="COVAXIN")
                            td7.classList.add("covaxin");
                            tr.appendChild(td7);
                            
                        }
                        c=0;
                        tbody.appendChild(tr);
                    }
                    newTable.appendChild(tbody);
                    searchResults.appendChild(newTable);
                }
                else
                {
                    document.getElementById('noResultFound').hidden=false;
                    searchResults.hidden=true;
                }
                /*newTable.innerHTML=
                `<div>
                    <thead>
                        <th>Center Name</th>
                        <th>Address</th>
                        <th>Age</th>
                        <th>Type</th>
                        <th>Dose 1</th>
                        <th>Dose 2</th>
                        <th>Vaccine</th>
                    </thead>
                    <tbody>
                            <tr>
                            <td>`
                                +i.name+`
                            </td>
                            <td>`
                                +i.address+
                            `</td>
                            <td style="color:blue">`
                                +i.min_age_limit+
                            `+</td>
                            <td>`
                                +i.fee_type+
                            `</td>
                            <td style="color:green;font-weight:bold">`
                                +i.available_capacity_dose1+
                            `+</td>
                            <td style="color:green;font-weight:bold;">`
                                +i.available_capacity_dose2+
                            `+</td>
                            <td>`
                                +i.vaccine+
                            `</td>
                        </tr>
                    </tbody>
                        </div>`
                        searchResults.appendChild(newTable);
                                }*/
                                
                    

            }
           /*async function districtsCenters{

            }*/
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous"></script>
    </body>
</html>